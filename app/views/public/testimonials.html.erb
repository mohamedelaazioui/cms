<h1 class="text-center mb-5"><%= t('testimonials.title') %></h1>

<% if @testimonials.any? %>
  <div id="testimonialCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
    <!-- Indicators -->
    <div class="carousel-indicators">
      <% @testimonials.each_with_index do |testimonial, index| %>
        <button type="button" data-bs-target="#testimonialCarousel" data-bs-slide-to="<%= index %>" 
                class="<%= 'active' if index == 0 %>" 
                aria-current="<%= 'true' if index == 0 %>" 
                aria-label="Slide <%= index + 1 %>"></button>
      <% end %>
    </div>

    <!-- Carousel Inner -->
    <div class="carousel-inner">
      <% @testimonials.each_with_index do |testimonial, index| %>
        <div class="carousel-item <%= 'active' if index == 0 %>">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="card shadow-lg border-0">
                <div class="card-body p-5 text-center">
                  <% if testimonial.avatar.attached? %>
                    <%= image_tag testimonial.avatar, 
                        style: 'width: 100px; height: 100px; border-radius: 50%; margin-bottom: 20px;',
                        class: 'mx-auto d-block' %>
                  <% else %>
                    <div class="bg-primary text-white rounded-circle mx-auto d-flex align-items-center justify-content-center mb-3" 
                         style="width: 100px; height: 100px; font-size: 2.5rem;">
                      <%= testimonial.name[0].upcase %>
                    </div>
                  <% end %>
                  
                  <h3 class="card-title mb-3"><%= testimonial.name %></h3>
                  
                  <div class="mb-3">
                    <i class="fas fa-quote-left text-primary" style="font-size: 2rem; opacity: 0.3;"></i>
                  </div>
                  
                  <p class="card-text lead" style="font-style: italic; font-size: 1.2rem; line-height: 1.8;">
                    <%= testimonial.quote %>
                  </p>
                  
                  <div class="mt-3">
                    <i class="fas fa-quote-right text-primary" style="font-size: 2rem; opacity: 0.3;"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: invert(1);"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true" style="filter: invert(1);"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>

<% else %>
  <div class="alert alert-info">
    <p><%= t('testimonials.no_testimonials') %></p>
  </div>
<% end %>

<div class="mt-5 text-center">
  <%= link_to t('testimonials.view_services'), services_path, class: 'btn btn-primary btn-lg' %>
  <%= link_to t('testimonials.back_to_home'), root_path, class: 'btn btn-secondary btn-lg' %>
</div>

<script>
  // Initialize Bootstrap carousel on page load and Turbo navigation
  document.addEventListener('turbo:load', function() {
    const carouselElement = document.querySelector('#testimonialCarousel');
    if (carouselElement) {
      // Dispose any existing carousel instance
      const existingCarousel = bootstrap.Carousel.getInstance(carouselElement);
      if (existingCarousel) {
        existingCarousel.dispose();
      }
      
      // Initialize new carousel with autoplay
      new bootstrap.Carousel(carouselElement, {
        interval: 5000,
        ride: 'carousel'
      });
    }
  });
</script>
